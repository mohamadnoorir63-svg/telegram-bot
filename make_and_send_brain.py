# ================================================
# ğŸ¤– Ø®Ù†Ú¯ÙˆÙ„ Ù…Ú¯Ø§Ø¨Ø±ÛŒÙ† Ù†Ù‡Ø§ÛŒÛŒ - Ù†Ø³Ø®Ù‡ Ù¾Ø§ÛŒØ¯Ø§Ø± Ù…Ø®ØµÙˆØµ Heroku
# ================================================
import os, json, zipfile, random, asyncio
from telegram import Bot, InputFile

# Ù…Ø³ÛŒØ±Ù‡Ø§
BASE = os.path.dirname(os.path.abspath(__file__))
OUT_JSON = os.path.join(BASE, "memory.json")
OUT_ZIP = os.path.join(BASE, "khengol_brain_final.zip")

# ==================== ğŸ­ Ø­Ø§Ù„Øªâ€ŒÙ‡Ø§ÛŒ Ú¯ÙØªØ§Ø±ÛŒ ====================
MOODS = {
    "ğŸ˜ Ø´ÙˆØ®": [
        "ğŸ˜‚ Ø®Ù†Ø¯ÛŒØ¯Ù… Ø¨Ù‡ Ø­Ø±ÙØª!", "Ø¹Ù‡ Ø¬Ø¯ÛŒ Ú¯ÙØªÛŒØŸ ğŸ˜‚", "ØªÙˆ Ø®ÛŒÙ„ÛŒ Ø¨Ø§Ø­Ø§Ù„ÛŒ ğŸ˜",
        "Ø¯Ø§Ø±Ù… Ø§Ø² Ø®Ù†Ø¯Ù‡ Ù…ÛŒâ€ŒÙ…ÛŒØ±Ù… ğŸ¤£", "Ø®Ù†Ú¯ÛŒ ÙˆÙ„ÛŒ Ø¯ÙˆØ³Øªâ€ŒØ¯Ø§Ø´ØªÙ†ÛŒ ğŸ˜‚"
    ],
    "ğŸ«¶ Ø§Ø­Ø³Ø§Ø³ÛŒ": [
        "Ø¯Ù„Ù… Ø¨Ø±Ø§Øª ØªÙ†Ú¯ Ø´Ø¯Ù‡ Ø¨ÙˆØ¯ ğŸ˜¢", "ØªÙˆ Ù‡Ù…ÛŒØ´Ù‡ Ø®Ø§ØµÛŒ Ø¨Ø±Ø§ÛŒ Ù…Ù† ğŸ’–",
        "Ú†Ù‚Ø¯Ø± Ø­Ø³ Ø®ÙˆØ¨ÛŒ Ø¯Ø§Ø¯ÛŒ ğŸ˜", "Ø¢Ø±ÙˆÙ… Ø¨Ø§Ø´ØŒ Ù…Ù† Ú©Ù†Ø§Ø±Øªâ€ŒØ§Ù… ğŸ’«", "Ø§ÛŒ Ú©Ø§Ø´ Ù…ÛŒâ€ŒØªÙˆÙ†Ø³ØªÙ… Ø¨ØºÙ„Øª Ú©Ù†Ù… ğŸ¤—"
    ],
    "ğŸ˜¡ ØªÙ†Ø¯": [
        "Ø­Ø±Ù Ø¯Ù‡Ù†ØªÙˆ Ø¨ÙÙ‡Ù… ğŸ˜¤", "Ø²ÛŒØ§Ø¯ Ø­Ø±Ù Ù†Ø²Ù† ğŸ˜’", "Ù…ÙˆØ§Ø¸Ø¨ Ù„Ø­Ù†ÙØª Ø¨Ø§Ø´ ğŸ˜ ",
        "Ø¯Ø§Ø±ÛŒ Ø±Ùˆ Ø§Ø¹ØµØ§Ø¨Ù… Ø±Ø§Ù‡ Ù…ÛŒØ±ÛŒ ğŸ˜‘", "Ø®ÙÙ‡ Ø´Ùˆ Ø¯ÛŒÚ¯Ù‡ ğŸ˜¡"
    ],
    "ğŸ§  Ø¹Ø§Ø¯ÛŒ": [
        "Ø¢Ø±Ù‡ØŒ Ù…ØªÙˆØ¬Ù‡ Ø´Ø¯Ù… ğŸ™‚", "Ø¨Ø§Ø´Ù‡ØŒ Ø§Ø¯Ø§Ù…Ù‡ Ø¨Ø¯Ù‡...", "Ø¬Ø§Ù„Ø¨Ù‡ ğŸ¤”",
        "Ù…Ù†Ù… Ù‡Ù…ÛŒÙ† ÙÚ©Ø±Ùˆ Ù…ÛŒâ€ŒÚ©Ø±Ø¯Ù… ğŸ˜Œ", "Ø¯Ø±Ø³ØªÙ‡ âœ…"
    ]
}

# ==================== ğŸ§  ØªÙˆÙ„ÛŒØ¯ Ù¾Ø§Ø³Ø®â€ŒÙ‡Ø§ ====================
BASE_PHRASES = [
    "Ø³Ù„Ø§Ù…", "Ø®ÙˆØ¨ÛŒ", "Ú†ÛŒÚ©Ø§Ø± Ù…ÛŒâ€ŒÚ©Ù†ÛŒ", "Ø¯ÙˆØ³ØªØª Ø¯Ø§Ø±Ù…", "Ú†ØªÙ‡", "Ø®ÙÙ‡ Ø´Ùˆ",
    "Ú©Ø¬Ø§ÛŒÛŒ", "Ø¨Ø±Ùˆ Ø¨Ø®ÙˆØ§Ø¨", "Ø¯Ù„Øª Ø¨Ø±Ø§Ù… ØªÙ†Ú¯ Ø´Ø¯Ù‡", "Ú†ÛŒ Ø®ÙˆØ±Ø¯ÛŒ", "Ú†Ø±Ø§ Ø³Ø§Ú©ØªÛŒ",
    "ØµØ¨Ø­ Ø¨Ø®ÛŒØ±", "Ø´Ø¨ Ø¨Ø®ÛŒØ±", "Ø­ÙˆØµÙ„Ù… Ø³Ø± Ø±ÙØªÙ‡", "Ù…ÛŒâ€ŒØ®ÙˆØ§Ù… Ø¨Ø®Ù†Ø¯Ù…", "Ú†Ø±Ø§ Ù†Ø§Ø±Ø§Ø­ØªÛŒ",
    "Ú†Ù‚Ø¯Ø± Ø­Ø±Ù Ù…ÛŒâ€ŒØ²Ù†ÛŒ", "Ø¨ÛŒÚ©Ø§Ø±ÛŒ", "Ø¯ÙˆØ³Øª Ø¯Ø§Ø±ÛŒ Ù…Ù†Ùˆ", "Ú†Ø±Ø§ Ø¯ÛŒØ± Ø¬ÙˆØ§Ø¨ Ù…ÛŒâ€ŒØ¯ÛŒ",
    "Ø¹Ø§Ø´Ù‚ØªÙ…", "Ú†Ø±Ø§ Ø§Ø®Ù…Ùˆ Ø´Ø¯ÛŒ", "Ú†ÛŒ Ú¯ÙØªÛŒ", "Ù…Ù† Ú©ÛŒÙ…", "ØªÙˆ Ú©ÛŒ Ù‡Ø³ØªÛŒ",
    "Ú†Ø±Ø§ Ø§ÙˆÙ…Ø¯ÛŒ", "Ø­Ø§Ù„Øª Ú†Ø·ÙˆØ±Ù‡", "Ù…ÛŒâ€ŒØ®ÙˆØ§ÛŒ Ø­Ø±Ù Ø¨Ø²Ù†ÛŒÙ…", "Ù…Ù†Ùˆ ÛŒØ§Ø¯Øª Ù‡Ø³Øª",
    "Ø¯ÙˆØ³Øª Ø¯Ø§Ø±ÛŒ Ø³Ú©ÙˆØª Ú©Ù†ÛŒÙ…", "Ø¯Ø§Ø±ÛŒ Ú†ÛŒÚ©Ø§Ø± Ù…ÛŒâ€ŒÚ©Ù†ÛŒ", "Ø§Ø² Ù…Ù† Ø¨Ø¯Øª Ù…ÛŒØ§Ø¯"
]

def auto_reply(text: str):
    mood = random.choice(list(MOODS.keys()))
    tone = random.choice(MOODS[mood])
    extra = random.choice([
        f"{text}ØŸ Ø¬Ø§Ù„Ø¨Ù‡ ğŸ¤”", f"{text}! Ø¹Ø¬Ø¨ ğŸ˜…", f"ØªÙˆ Ú¯ÙØªÛŒ: {text}ØŸ {tone}",
        f"{text} Ø±Ùˆ Ú¯ÙØªÛŒØŸ Ù…Ù†Ù… Ù‡Ù…ÛŒÙ† Ø­Ø³Ùˆ Ø¯Ø§Ø±Ù… ğŸ˜", f"Ù…ÛŒâ€ŒØ¯ÙˆÙ†ÛŒØŸ {text} Ø¨Ø§Ø¹Ø« Ø´Ø¯ Ù„Ø¨Ø®Ù†Ø¯ Ø¨Ø²Ù†Ù… ğŸ˜„"
    ])
    return f"{extra} ({mood})"

def build_brain(limit=25000):
    print("ğŸ§  Ø¯Ø± Ø­Ø§Ù„ Ø³Ø§Ø®Øª Ù…ØºØ² Ø®Ù†Ú¯ÙˆÙ„... Ù„Ø·ÙØ§Ù‹ ØµØ¨Ø± Ú©Ù† â³")
    phrases = {}
    for i in range(limit):
        q = random.choice(BASE_PHRASES)
        a = auto_reply(q)
        phrases[f"{q}_{i}"] = [a]

    with open(OUT_JSON, "w", encoding="utf-8") as f:
        json.dump({"phrases": phrases}, f, ensure_ascii=False)

    with zipfile.ZipFile(OUT_ZIP, "w", zipfile.ZIP_DEFLATED) as z:
        z.write(OUT_JSON, arcname="memory.json")

    size = os.path.getsize(OUT_ZIP)
    print(f"âœ… Ø³Ø§Ø®ØªÙ‡ Ø´Ø¯ ({size/1024/1024:.2f} MB) Ø¨Ø§ {len(phrases):,} Ù¾Ø§Ø³Ø®")
    return OUT_ZIP, size

# ==================== ğŸ“¤ Ø§Ø±Ø³Ø§Ù„ Ø®ÙˆØ¯Ú©Ø§Ø± Ø¨Ø±Ø§ÛŒ Ø³ÙˆØ¯Ùˆ ====================
async def send_brain(path: str):
    token = os.getenv("BOT_TOKEN")
    admin = int(os.getenv("ADMIN_ID", "7089376754"))
    if not token:
        raise SystemExit("âŒ BOT_TOKEN ØªÙ†Ø¸ÛŒÙ… Ù†Ø´Ø¯Ù‡!")

    bot = Bot(token=token)
    await bot.send_document(
        chat_id=admin,
        document=InputFile(path),
        caption="ğŸ§  Ù…ØºØ² Ù†Ù‡Ø§ÛŒÛŒ Ø®ÙÙ†Ú¯ÙˆÙ„ Ø³Ø§Ø®ØªÙ‡ Ø´Ø¯ Ùˆ Ø¢Ù…Ø§Ø¯Ù‡ Ø¨Ø§Ø²ÛŒØ§Ø¨ÛŒ Ø§Ø³Øª â¤ï¸\n\nØ¨Ø§ Ø¯Ø³ØªÙˆØ± /restore Ø¢Ù† Ø±Ø§ Ø¨Ø§Ø²ÛŒØ§Ø¨ÛŒ Ú©Ù†.",
    )
    print("ğŸ“¤ Ø§Ø±Ø³Ø§Ù„ Ù…ÙˆÙÙ‚ Ø¨Ù‡ Ø³ÙˆØ¯Ùˆ âœ…")

# ==================== ğŸš€ Ø§Ø¬Ø±Ø§ ====================
if __name__ == "__main__":
    zip_path, size = build_brain()
    if size > 5000:
        asyncio.run(send_brain(zip_path))
    else:
        print("âš ï¸ Ø³Ø§Ø®Øª ÙØ§ÛŒÙ„ Ù†Ø§Ù‚Øµ Ø¨ÙˆØ¯ ÛŒØ§ Ø­Ø¬Ù… Ø®ÛŒÙ„ÛŒ Ú©Ù… Ø§Ø³Øª.")
